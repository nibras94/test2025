<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-head-title">المواد الدراسية | [اسم موقعك]</title> 
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <link rel="stylesheet" href="style.css">
    <script src="script.js"></script>

    <style>
        /* تم توحيد الستايل هنا ليعتمد كلياً على متغيرات style.css وكلاسات Tailwind */
        .sidebar { 
            background-color: var(--color-background-secondary); 
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); 
            border: 1px solid var(--color-border-dark);
        }
        .text-accent { color: var(--color-accent-teal) !important; }
        .text-primary-color { color: var(--color-text-primary) !important; }
        
        /* تنسيق بطاقات المواضيع (Topic Cards) والمواد (Subject Cards) */
        .topic-card {
            transition: transform 0.2s, border-color 0.2s;
            border-left: 5px solid transparent; /* شريط الإبراز الجانبي */
            height: 100%;
            background-color: var(--color-background-secondary) !important;
            color: var(--color-text-primary) !important;
        }
        .topic-card:hover {
            transform: translateY(-3px);
            border-left-color: var(--color-accent-teal);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }
        .btn-custom-back {
            color: var(--color-accent-teal) !important;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <header class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <h2 id="page-main-title" class="navbar-brand text-accent fs-4 fw-bold">المواد الدراسية</h2>
            </div>
    </header>

    <main class="container mt-4">
        
        <div class="sidebar p-4 p-md-5">
            <div class="d-flex justify-content-between align-items-center border-bottom border-gray-600 pb-3 mb-4">
                
                <a id="dynamic-back-link" href="courses.html" class="btn btn-link btn-custom-back p-0">
                    « العودة
                </a>
                
                <h1 id="current-content-title" class="fs-4 fw-bold text-primary-color">...</h1>
            </div>

            <div id="content-list" class="row row-cols-1 row-cols-md-2 g-4">
                <div class="col-12 text-center text-secondary p-5" id="loading-message">
                    جاري تحميل المحتوى...
                </div>
            </div>
            
        </div>
        
    </main>

    <footer class="text-center py-3 mt-5" style="background-color: #0d1736; border-top: 1px solid #374151;">
        <small class="text-secondary">&copy; 2025 منصة المراجعات التعليمية. جميع الحقوق محفوظة.</small>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        // ******************************************************
        // بيانات المشروع - تم حصر مواضيع العلوم هنا
        // ******************************************************
        const COURSE_DATA = {
            'primary6': {
                id: 'primary6',
                name: 'السادس الابتدائي',
                subjects: {
                    'social': {
                        id: 'social',
                        name: 'الاجتماعيات',
                        icon: '📚',
                        topics: [
                            { id: 'taareef', name: 'التعاريف والمصطلحات', url: 'primary6/social/course_page.html' }, 
                            { id: 'taaleel', name: 'التعاليل والتفسيرات', url: 'primary6/social/social_definitions.html' },
                            { id: 'dates', name: 'الشخصيات والتواريخ', url: 'primary6/social/social_reasons.html' },
                        ]
                    },
                    // **تم تعديل هذا الجزء: حصر المواضيع لـ 2 فقط**
                    'science': {
                        id: 'science',
                        name: 'العلوم',
                        icon: '🔬',
                        topics: [
                            { id: 'taareef', name: 'التعاريف والمصطلحات', url: 'primary6/science/course_page.html' }, 
                            { id: 'taaleel', name: 'التعاليل والمقارنات', url: 'primary6/science/science_تعاليل.html' },
                        ]
                    },
                    'math': { id: 'math', name: 'الرياضيات', icon: '📐', topics: [{ id: 'laws', name: 'القوانين والملخصات', url: 'primary6/math/laws.html' }] },
                    'islamic': { id: 'islamic', name: 'التربية الإسلامية', icon: '🕌', topics: [{ id: 'hifdh', name: 'الحفظيات والتعاليم', url: 'primary6/islamic/hifdh.html' }] },
                    'arabic': { id: 'arabic', name: 'اللغة العربية', icon: '✍️', topics: [{ id: 'qawaed', name: 'القواعد والإعراب', url: 'primary6/arabic/qawaed.html' }] },
                    'english': { id: 'english', name: 'اللغة الإنجليزية', icon: '🇬🇧', topics: [{ id: 'grammar', name: 'القواعد والمفردات', url: 'primary6/english/grammar.html' }] }
                }
            },
            'middle3': {
                id: 'middle3',
                name: 'الثالث المتوسط',
                subjects: { /* ... */ }
            }
        };

        // ******************************************************
        // منطق التحميل الديناميكي والروابط
        // ******************************************************

        function getUrlParams() {
            const params = {};
            const queryString = window.location.search.substring(1);
            const regex = /([^&=]+)=([^&]*)/g;
            let m;
            while (m = regex.exec(queryString)) {
                params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
            }
            return params;
        }

        function renderSubjects(courseId, courseData) {
            const listContainer = document.getElementById('content-list');
            
            document.getElementById('page-main-title').textContent = `${courseData.name}: قائمة المواد`;
            document.getElementById('page-head-title').textContent = `${courseData.name}: قائمة المواد`;
            document.getElementById('current-content-title').textContent = 'اختر المادة الدراسية:';

            const backLinkContainer = document.getElementById('dynamic-back-link');
            backLinkContainer.href = 'courses.html'; 
            backLinkContainer.textContent = `« العودة لقائمة المراحل`;
            
            // تهيئة القائمة للمواد (شبكة 3x3)
            listContainer.className = 'row row-cols-1 row-cols-md-3 g-4';
            
            let htmlContent = '';
            for (const subjectId in courseData.subjects) {
                const subject = courseData.subjects[subjectId];
                // الرابط الديناميكي لتوجيه لصفحة المواضيع
                const link = `course_page.html?course_id=${courseId}&subjectId=${subjectId}`; 
                
                htmlContent += `
                    <div class="col">
                        <a href="${link}" class="card topic-card h-100 p-3 text-decoration-none">
                            <div class="card-body">
                                <h5 class="card-title text-accent fs-5 fw-bold">${subject.icon} ${subject.name}</h5>
                                <p class="card-text text-secondary">انقر لعرض التعاريف والأسئلة.</p>
                            </div>
                        </a>
                    </div>`;
            }
            listContainer.innerHTML = htmlContent;
        }

        function renderTopics(courseId, subjectId) {
            const listContainer = document.getElementById('content-list');
            const courseData = COURSE_DATA[courseId];
            const subjectData = courseData ? courseData.subjects[subjectId] : null;

            if (!subjectData) {
                 listContainer.innerHTML = '<div class="col-12 text-center text-danger p-5">عذراً، لم يتم العثور على المواضيع المطلوبة.</div>';
                 return;
            }
            
            document.getElementById('page-main-title').textContent = `${subjectData.name} - ${courseData.name}`;
            document.getElementById('page-head-title').textContent = `${subjectData.name}: قائمة المواضيع`;
            document.getElementById('current-content-title').textContent = 'اختر نوع الملخص أو المراجعة:';

            // تحديد رابط العودة لقائمة المواد
            const backLinkContainer = document.getElementById('dynamic-back-link');
            const backLinkUrl = `course_page.html?course_id=${courseId}`; // العودة إلى قائمة المواد لنفس المرحلة
            backLinkContainer.href = backLinkUrl;
            backLinkContainer.textContent = `« العودة لقائمة مواد ${courseData.name}`;

            // تهيئة القائمة للمواضيع (شبكة 2x2)
            listContainer.className = 'row row-cols-1 row-cols-md-2 g-4';
            
            let htmlContent = '';
            subjectData.topics.forEach(topic => {
                // الرابط إلى الملف الثابت في المجلد الفرعي (الخروج مجلدين)
                const fullUrl = topic.url; 

                htmlContent += `
                    <div class="col">
                        <a href="${fullUrl}" class="card topic-card h-100 p-3 text-decoration-none">
                             <div class="card-body">
                                <h5 class="card-title text-accent fs-5 fw-bold">📄 ${topic.name}</h5>
                            </div>
                        </a>
                    </div>`;
            });

            listContainer.innerHTML = htmlContent;
        }

        function initializePage() {
            // **ملاحظة: هذا الكود سيعمل فقط مع وجود script.js الذي يستدعي Firebase Auth**
            
            const params = getUrlParams();
            const courseId = params.course_id;
            const subjectId = params.subjectId;
            
            const loadingMessage = document.getElementById('loading-message');
            if (loadingMessage) loadingMessage.remove(); 

            if (!courseId) {
                // يجب أن تكون هذه الخطوة محمية في script.js
                window.location.href = 'courses.html';
                return; 
            }
            
            const courseData = COURSE_DATA[courseId];
            if (!courseData) {
                 document.getElementById('page-main-title').textContent = 'خطأ';
                 document.getElementById('current-content-title').textContent = 'المرحلة غير موجودة.';
                 return;
            }

            if (subjectId) {
                // عرض قائمة المواضيع (المستوى الثالث)
                renderTopics(courseId, subjectId);
            } else {
                // عرض قائمة المواد (المستوى الثاني)
                renderSubjects(courseId, courseData);
            }
        }

        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>